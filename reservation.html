<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
    <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest"></script>

    <title>Document</title>
</head>
<body>
    <h1>Reservation</h1>
    <!--<div class="row">
        <div class="col-sm-4  ">
          
    <form class="add"> 
    <label for="title">User id</label>
    <input type="text" name="id" required></br></br>
    <label for="author">Books id</label>
    <input type="text" name="book id" required></br></br>-->
    
<!--zXing scan IBSN of books -->
<video id="webcam-preview"></video>
<p id="result"></p>

<video id="video" width="300" height="200" style="border: 1px solid gray" ></video>
<button onclick="startScanning()">Start Scanning</button>


    <button>Reserve Book</button>
  </form>

  
<script>
  const codeReader = new ZXing.BrowserMultiFormatReader();


  function startScanning() {
  codeReader.decodeFromVideoDevice(null, 'webcam-preview', (result, err) => {
    if (result) {
      // properly decoded qr code
      console.log('Found QR code!', result)
       // Call displayBook function 
      //Here will be the function to dislay books( if ISBN exist in my database display book)

      document.getElementById('result').textContent = result.text
      let scanedBook = result.text;
      
// Call applyH function
applyH(result.text); // Pass result.text instead of result
      
    }

    if (err) {
      // As long as this error belongs into one of the following categories
      // the code reader is going to continue as excepted. Any other error
      // will stop the decoding loop.
      //
      // Excepted Exceptions:
      //
      //  - NotFoundException
      //  - ChecksumException
      //  - FormatException

      if (err instanceof ZXing.NotFoundException) {
        console.log('No QR code found.')
      }

      if (err instanceof ZXing.ChecksumException) {
        console.log('A code was found, but it\'s read value was not valid.')
      }

      if (err instanceof ZXing.FormatException) {
        console.log('A code was found, but it was in a invalid format.')
      }
    }
  })
}
// Define applyH function outside of startScanning
function applyH(resultText) {
  if (resultText === "9785465038768") {
    console.log("YEEEEEEEEEEEES");
  }}



async function displayBook(scannedISBN) {
    try {
      const booksRef = await getDocs(collection(db, 'books'));
      booksRef.forEach((doc) => {
        const bookData = doc.data();
        if (bookData.ISBN === scannedISBN) {
          // Display book information (you can modify this as per your HTML structure)
          document.getElementById('result').innerHTML = `
            <p>Title: ${bookData.title}</p>
            <p>Author: ${bookData.author}</p>
            <p>ISBN: ${bookData.ISBN}</p>
          `;
        }
      });
    } catch (error) {
      console.error('Error displaying book:', error);
    }
  }



</script>
<script import { getFirestore, doc, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";></script>
</body>
</html>